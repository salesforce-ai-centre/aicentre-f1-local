<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F1 Real-time Dashboard</title>
    <link rel="stylesheet" href="/static/css/style-enhanced.css">
    <!-- Add gauge.js library -->
    <script src="/static/js/gauge.min.js"></script>
    <!-- Add Chart.js for performance charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Theme Toggle Button -->
    <button class="theme-toggle" id="themeToggle">
        <span class="theme-toggle-icon" id="themeIcon">🌙</span>
        <span class="theme-toggle-text">Light Mode</span>
    </button>

    <!-- Name Capture Modal -->
    <div id="nameModal" class="modal">
        <div class="modal-content">
            <h2>Enter Your Name</h2>
            <p>Please enter your name before starting the session:</p>
            <input type="text" id="driverNameInput" placeholder="Enter your name" maxlength="50">
            <div class="modal-buttons">
                <button id="startSessionBtn" class="btn-primary">Start Session</button>
            </div>
        </div>
    </div>

    <div class="top-bar">
        <div class="logo">
            <svg class="sf-logo" width="100" height="50" viewBox="0 0 120 50">
                <!-- Simplified Salesforce-style logo -->
                <circle cx="25" cy="25" r="20" fill="#0176d3"/>
                <text x="25" y="32" text-anchor="middle" font-family="Arial" font-size="18" fill="white" font-weight="bold">F1</text>
            </svg>
        </div>
        <h1>F1 Real-time Dashboard</h1>
        <div class="status-indicators">
            <div class="connection-status">
                <span class="status-indicator disconnected" id="connectionStatus"></span>
                <span class="status-text" id="connectionText">Disconnected</span>
            </div>
            <div class="data-quality">
                <span class="quality-indicator" id="dataQuality"></span>
                <span class="quality-text" id="dataQualityText">No Data</span>
            </div>
        </div>
    </div>

    <div class="grid-container">
        <!-- Session Info Card -->
        <div id="session-card" class="card">
            <h2>Session Info</h2>
            <div class="session-info">
                <div class="driver-section">
                    <span class="driver-name" id="driverName">-</span>
                    <span class="position-badge" id="positionBadge">-</span>
                </div>
                <div class="track-name-container">
                    <span class="track-label">Track:</span>
                    <span class="track-value" id="trackName">-</span>
                </div>
                <div class="session-grid">
                    <div class="session-item">
                        <span class="metric-label">Position</span>
                        <span class="metric-value" id="position">-</span>
                    </div>
                    <div class="session-item">
                        <span class="metric-label">Lap</span>
                        <span class="metric-value" id="currentLap">-</span>
                    </div>
                    <div class="session-item">
                        <span class="metric-label">Valid</span>
                        <span class="metric-value status-pill" id="lapValid">-</span>
                    </div>
                </div>
                <div class="time-section">
                    <div class="time-item">
                        <span class="time-label">Current Lap</span>
                        <span class="time-value" id="currentLapTime">--.---.---</span>
                        <span class="delta-timing delta-neutral" id="currentDelta">-</span>
                    </div>
                    <div class="time-item">
                        <span class="time-label">Last Lap</span>
                        <span class="time-value" id="lastLapTime">--.---.---</span>
                        <span class="personal-best" id="personalBest">Best: --:---.---</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Speed & RPM Gauges -->
        <div id="gauges-card" class="card">
            <h2>Vitals</h2>
            <div class="gauges">
                <div class="gauges-flex-container">
                    <div class="gauges-column">
                        <div class="gauge-container">
                            <canvas id="speedGauge" class="gauge"></canvas>
                            <div class="gauge-label">Speed</div>
                            <div class="gauge-value" id="speedValue">0 km/h</div>
                        </div>
                    </div>
                    <div class="gauges-column">
                        <div class="gear-display">
                            <span id="gear">N</span>
                        </div>
                        <div class="gauge-container">
                            <canvas id="rpmGauge" class="gauge"></canvas>
                            <div class="gauge-label">RPM</div>
                            <div class="gauge-value" id="rpmValue">0</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Inputs with Visual Bars -->
        <div id="inputs-card" class="card">
            <h2>Inputs</h2>
            <div class="inputs">
                <div class="inputs-container">
                    <!-- Enhanced Throttle Bar -->
                    <div class="input-visual-bar">
                        <span class="input-visual-label">Throttle</span>
                        <div class="input-visual-fill throttle" id="throttleVisual" style="width: 0%">
                            <span class="input-visual-value" id="throttlePercent">0%</span>
                        </div>
                    </div>

                    <!-- Enhanced Brake Bar -->
                    <div class="input-visual-bar">
                        <span class="input-visual-label">Brake</span>
                        <div class="input-visual-fill brake" id="brakeVisual" style="width: 0%">
                            <span class="input-visual-value" id="brakePercent">0%</span>
                        </div>
                    </div>

                    <!-- Steering Wheel -->
                    <div class="steering-container">
                        <span class="steering-label">Steering</span>
                        <div class="steering-wheel">
                            <div class="steering-indicator" id="steeringIndicator"></div>
                        </div>
                        <span class="steering-value" id="steeringValue">0°</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Tyres with Visual Highlighting -->
        <div id="tyres-card" class="card">
            <h2>Tyres & Temps</h2>
            <div class="tyres">
                <div class="compound-container">
                    <span class="tyre-compound-label">Compound:</span>
                    <span class="compound-badge" id="tyreCompound">-</span>
                </div>
                <div class="car-tyres-container">
                    <div class="car-outline-tyres">
                        <div class="car-shape"></div>
                        <div class="tyre-visual-grid">
                            <div class="tyre-visual">
                                <div class="tyre-circle" id="tyreFrontLeft">
                                    <div class="tyre-inner">
                                        <span class="tyre-label">FL</span>
                                        <div class="tyre-metrics">
                                            <span class="tyre-wear" id="tyreFLWear">0%</span>
                                            <span class="tyre-temp" id="tyreFLTemp">0°C</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tyre-visual">
                                <div class="tyre-circle" id="tyreFrontRight">
                                    <div class="tyre-inner">
                                        <span class="tyre-label">FR</span>
                                        <div class="tyre-metrics">
                                            <span class="tyre-wear" id="tyreFRWear">0%</span>
                                            <span class="tyre-temp" id="tyreFRTemp">0°C</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tyre-visual">
                                <div class="tyre-circle" id="tyreRearLeft">
                                    <div class="tyre-inner">
                                        <span class="tyre-label">RL</span>
                                        <div class="tyre-metrics">
                                            <span class="tyre-wear" id="tyreRLWear">0%</span>
                                            <span class="tyre-temp" id="tyreRLTemp">0°C</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tyre-visual">
                                <div class="tyre-circle" id="tyreRearRight">
                                    <div class="tyre-inner">
                                        <span class="tyre-label">RR</span>
                                        <div class="tyre-metrics">
                                            <span class="tyre-wear" id="tyreRRWear">0%</span>
                                            <span class="tyre-temp" id="tyreRRTemp">0°C</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ERS & DRS Status -->
        <div id="ers-drs-card" class="card">
            <h2>ERS & DRS</h2>
            <div class="ers-drs">
                <div class="ers-drs-container">
                    <div class="drs-section">
                        <div class="drs-indicator-container">
                            <div class="drs-label">DRS</div>
                            <div class="drs-indicator">
                                <span id="drsStatus" class="status-off">INACTIVE</span>
                            </div>
                        </div>
                    </div>

                    <div class="ers-section">
                        <div class="ers-meter-container">
                            <div class="ers-header">
                                <span class="ers-title">ERS Store</span>
                                <span class="ers-value" id="ersPercent">0%</span>
                            </div>
                            <div class="ers-meter">
                                <progress id="ersStoreBar" class="ers-progress" value="0" max="100"></progress>
                            </div>
                        </div>

                        <div class="deploy-mode-container">
                            <span class="deploy-label">Deploy Mode:</span>
                            <span class="deploy-mode" id="ersDeployMode">None</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Damage Status -->
        <div id="damage-card" class="card">
            <h2>Damage</h2>
            <div class="damage">
                <div class="damage-grid">
                    <div class="damage-item">
                        <span class="damage-label">Front Left Wing</span>
                        <div class="damage-bar-container">
                            <div class="damage-bar" id="damageBarFL" style="width: 0%"></div>
                        </div>
                        <span class="damage-value damage-value-low" id="damageFL">0%</span>
                    </div>
                    <div class="damage-item">
                        <span class="damage-label">Front Right Wing</span>
                        <div class="damage-bar-container">
                            <div class="damage-bar" id="damageBarFR" style="width: 0%"></div>
                        </div>
                        <span class="damage-value damage-value-low" id="damageFR">0%</span>
                    </div>
                    <div class="damage-item">
                        <span class="damage-label">Rear Wing</span>
                        <div class="damage-bar-container">
                            <div class="damage-bar" id="damageBarRear" style="width: 0%"></div>
                        </div>
                        <span class="damage-value damage-value-low" id="damageRear">0%</span>
                    </div>
                    <div class="damage-item">
                        <span class="damage-label">Floor</span>
                        <div class="damage-bar-container">
                            <div class="damage-bar" id="damageBarFloor" style="width: 0%"></div>
                        </div>
                        <span class="damage-value damage-value-low" id="damageFloor">0%</span>
                    </div>
                    <div class="damage-item">
                        <span class="damage-label">Engine</span>
                        <div class="damage-bar-container">
                            <div class="damage-bar" id="damageBarEngine" style="width: 0%"></div>
                        </div>
                        <span class="damage-value damage-value-low" id="damageEngine">0%</span>
                    </div>
                    <div class="damage-item">
                        <span class="damage-label">Gearbox</span>
                        <div class="damage-bar-container">
                            <div class="damage-bar" id="damageBarGearbox" style="width: 0%"></div>
                        </div>
                        <span class="damage-value damage-value-low" id="damageGearbox">0%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Advanced Analytics with G-Force Meter -->
        <div id="analytics-card" class="card">
            <h2>Advanced Analytics</h2>
            <div class="analytics">
                <div class="analytics-grid">
                    <!-- 2D G-Force Meter -->
                    <div class="g-force-container">
                        <div class="g-force-title">G-Force</div>
                        <div class="g-force-meter">
                            <div class="g-force-grid"></div>
                            <div class="g-force-labels">
                                <span class="g-force-label top">+2G</span>
                                <span class="g-force-label bottom">-2G</span>
                                <span class="g-force-label left">-2G</span>
                                <span class="g-force-label right">+2G</span>
                            </div>
                            <div class="g-force-dot" id="gForceDot"></div>
                        </div>
                        <div class="g-force-values">
                            <div class="g-force-value-item">
                                <span class="g-force-value-label">Lateral</span>
                                <span class="g-force-value-number" id="gLateral">0.0g</span>
                            </div>
                            <div class="g-force-value-item">
                                <span class="g-force-value-label">Longitudinal</span>
                                <span class="g-force-value-number" id="gLongitudinal">0.0g</span>
                            </div>
                        </div>
                    </div>

                    <!-- Throttle vs Brake Overlay -->
                    <div class="input-overlay-container">
                        <div class="overlay-title">Throttle vs Brake Trace</div>
                        <canvas id="inputOverlayChart" class="input-overlay-chart"></canvas>
                    </div>

                    <!-- Fuel Strategy -->
                    <div class="fuel-strategy-container">
                        <div class="strategy-title">Fuel Strategy</div>
                        <div class="fuel-info">
                            <div class="fuel-item">
                                <span class="fuel-label">Fuel Load:</span>
                                <span class="fuel-value" id="fuelLoad">-.-kg</span>
                            </div>
                            <div class="fuel-item">
                                <span class="fuel-label">Fuel Mix:</span>
                                <span class="fuel-value" id="fuelMix">Standard</span>
                            </div>
                            <div class="fuel-item">
                                <span class="fuel-label">Laps Remaining:</span>
                                <span class="fuel-value" id="fuelLaps">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced AI Race Coach with Icons -->
        <div id="ai-coach-card" class="card">
            <h2>AI Race Coach</h2>
            <div class="ai-coach-content">
                <div class="ai-coach-messages" id="aiCoachMessages">
                    <div class="ai-message">
                        <span class="ai-message-icon">🏁</span>
                        <div class="ai-message-content">
                            <div class="ai-message-type">System Ready</div>
                            <div class="ai-message-text">Waiting for telemetry data from F1 game...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Lap Chart -->
        <div id="lap-chart-card" class="card">
            <h2>Lap Times</h2>
            <div class="chart-container">
                <canvas id="lapChart"></canvas>
            </div>
        </div>

        <!-- Enhanced Event Log with Icons -->
        <div id="event-log-card" class="card">
            <h2>Events & Alerts</h2>
            <div class="event-log" id="eventLog">
                <div class="event-messages">
                    <div class="event-message event-info">
                        <span class="event-icon">ℹ️</span>
                        <span>Session started</span>
                        <span class="event-timestamp">00:00</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/script-enhanced.js"></script>
    <script>
        // Check for sessionId in URL and auto-fill driver name
        (async function() {
            const urlParams = new URLSearchParams(window.location.search);
            const sessionId = urlParams.get('sessionId');
            const rigNumber = urlParams.get('rig');

            if (sessionId) {
                try {
                    // Fetch session details
                    const response = await fetch(`/api/session/${sessionId}`);
                    const data = await response.json();

                    if (data.success && data.session) {
                        const driverName = data.session.Driver_Name__c;

                        // Auto-fill the driver name input
                        const nameInput = document.getElementById('driverNameInput');
                        if (nameInput) {
                            nameInput.value = driverName;
                        }

                        // Auto-click the start button to skip modal
                        const startBtn = document.getElementById('startSessionBtn');
                        if (startBtn) {
                            setTimeout(() => {
                                startBtn.click();
                            }, 100);
                        }

                        // Update session info display
                        const sessionInfoDiv = document.querySelector('.session-info');
                        if (sessionInfoDiv) {
                            const driverDisplay = sessionInfoDiv.querySelector('.info-item:first-child .info-value');
                            if (driverDisplay) {
                                driverDisplay.textContent = driverName;
                            }
                        }
                    }
                } catch (error) {
                    console.error('Failed to load session:', error);
                }
            }
        })();
    </script>
</body>
</html>