<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dual-Rig F1 Telemetry Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dual-rig-style.css') }}">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js" crossorigin="anonymous"></script>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-left">
                <img src="/static/assets/SF_F1_logo.jpeg" alt="Salesforce F1 Partnership" class="brand-logo">
                <h1>Dual-Rig F1 25 Telemetry</h1>
            </div>
            <div class="header-right">
                <div class="datacloud-status">
                    <span class="datacloud-indicator"></span>
                    <span class="datacloud-text">
                        Streaming to Data 360
                    </span>
                </div>
                <div class="connection-status">
                    <span class="status-indicator" id="connectionStatus"></span>
                    <span id="connectionText">Connecting...</span>
                </div>
            </div>
        </header>

        <!-- Player Name Modal -->
        <div id="playerNameModal" class="modal">
            <div class="modal-content">
                <h3>Save Session</h3>
                <p>Enter player names for the completed session:</p>
                <div class="player-inputs">
                    <div class="player-input-group">
                        <label for="rigA-playerName">ðŸ”´ Sim Rig 1</label>
                        <input type="text" id="rigA-playerName" placeholder="Player name" maxlength="20">
                        <div class="player-best-time">Best: <span id="rigA-modalBestTime">--:--.---</span></div>
                    </div>
                    <div class="player-input-group">
                        <label for="rigB-playerName">ðŸ”µ Sim Rig 2</label>
                        <input type="text" id="rigB-playerName" placeholder="Player name" maxlength="20">
                        <div class="player-best-time">Best: <span id="rigB-modalBestTime">--:--.---</span></div>
                    </div>
                </div>
                <div class="modal-buttons">
                    <button class="btn btn-primary" id="confirmSaveBtn">Save</button>
                    <button class="btn btn-secondary" id="cancelSaveBtn">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Main Content: Three Column Layout -->
        <div class="split-view">
            <!-- LEFT: Sim Rig 1 Panel -->
            <div class="rig-panel" id="rigAPanel">
                <div class="rig-header rig-a-header">
                    <h2>ðŸ”´ Sim Rig 1</h2>
                    <div class="rig-status" id="rigAStatus">Waiting for data...</div>
                    <div class="driver-name" id="rigADriver">{{ rigs[0].driver_name }}</div>
                    <div class="session-details">
                        <span class="track-name" id="rigA-trackName">--</span> â€¢
                        <span class="session-type" id="rigA-sessionType">--</span>
                    </div>
                </div>

                <div class="telemetry-grid">
                    <!-- Speed & Gear Row -->
                    <div class="metric-card speed-card">
                        <h3>Speed</h3>
                        <div class="metric-value large" id="rigA-speed">0</div>
                        <div class="metric-unit">km/h</div>
                    </div>

                    <div class="metric-card gear-card">
                        <h3>Gear</h3>
                        <div class="metric-value gear" id="rigA-gear">N</div>
                    </div>

                    <!-- RPM -->
                    <div class="metric-card rpm-card">
                        <h3>RPM</h3>
                        <div class="metric-value large" id="rigA-rpm">0</div>
                        <div class="rpm-bar-container">
                            <div class="rpm-bar" id="rigA-rpmBar"></div>
                        </div>
                    </div>

                    <!-- Throttle/Brake/Steering -->
                    <div class="metric-card inputs-card">
                        <h3>Inputs</h3>
                        <div class="input-bars">
                            <div class="input-row">
                                <label>Throttle</label>
                                <div class="bar-container">
                                    <div class="bar throttle-bar" id="rigA-throttleBar"></div>
                                </div>
                                <span class="input-value" id="rigA-throttle">0%</span>
                            </div>
                            <div class="input-row">
                                <label>Brake</label>
                                <div class="bar-container">
                                    <div class="bar brake-bar" id="rigA-brakeBar"></div>
                                </div>
                                <span class="input-value" id="rigA-brake">0%</span>
                            </div>
                            <div class="input-row steering-row">
                                <label>Steering</label>
                                <div class="steering-wheel-container">
                                    <svg class="steering-wheel" viewBox="0 0 120 120" width="120" height="120">
                                        <defs>
                                            <!-- Gradient for wheel -->
                                            <radialGradient id="wheelGradientA">
                                                <stop offset="0%" style="stop-color:#4a5568;stop-opacity:1" />
                                                <stop offset="100%" style="stop-color:#2d3748;stop-opacity:1" />
                                            </radialGradient>
                                        </defs>

                                        <!-- Outer ring -->
                                        <circle cx="60" cy="60" r="45" fill="none" stroke="#2a2f3e" stroke-width="8"/>

                                        <!-- Steering wheel with rotation -->
                                        <g id="rigA-wheelRotate">
                                            <!-- Wheel rim -->
                                            <circle cx="60" cy="60" r="35" fill="url(#wheelGradientA)" stroke="#1a202c" stroke-width="3"/>

                                            <!-- Spokes -->
                                            <line x1="60" y1="30" x2="60" y2="90" stroke="#1a202c" stroke-width="4"/>
                                            <line x1="30" y1="60" x2="90" y2="60" stroke="#1a202c" stroke-width="4"/>

                                            <!-- Center hub -->
                                            <circle cx="60" cy="60" r="10" fill="#1a202c" stroke="#4a5568" stroke-width="2"/>

                                            <!-- Top marker (12 o'clock position) -->
                                            <circle cx="60" cy="30" r="4" fill="#FFB740"/>
                                        </g>
                                    </svg>

                                    <!-- Direction indicators -->
                                    <div class="steering-indicators">
                                        <div class="steer-indicator left" id="rigA-steerLeft">L</div>
                                        <div class="steer-indicator right" id="rigA-steerRight">R</div>
                                    </div>
                                </div>
                                <span class="input-value" id="rigA-steer">0Â°</span>
                            </div>
                        </div>
                    </div>

                    <!-- G-Forces -->
                    <div class="metric-card gforce-card">
                        <h3>G-Forces</h3>
                        <div class="gforce-display">
                            <div class="gforce-item">
                                <span class="gforce-label">LAT</span>
                                <span class="gforce-value" id="rigA-gLat">0.0</span>
                            </div>
                            <div class="gforce-item">
                                <span class="gforce-label">LONG</span>
                                <span class="gforce-value" id="rigA-gLong">0.0</span>
                            </div>
                            <div class="gforce-item">
                                <span class="gforce-label">VERT</span>
                                <span class="gforce-value" id="rigA-gVert">0.0</span>
                            </div>
                        </div>
                    </div>

                    <!-- Tyre Temps -->
                    <div class="metric-card tyre-card">
                        <h3>Tyre Temps (Â°C)</h3>
                        <div class="tyres">
                            <div class="tyre-row">
                                <div class="tyre" id="rigA-tyreFL">
                                    <span class="tyre-label">FL</span>
                                    <span class="tyre-temp">--</span>
                                </div>
                                <div class="tyre" id="rigA-tyreFR">
                                    <span class="tyre-label">FR</span>
                                    <span class="tyre-temp">--</span>
                                </div>
                            </div>
                            <div class="tyre-row">
                                <div class="tyre" id="rigA-tyreRL">
                                    <span class="tyre-label">RL</span>
                                    <span class="tyre-temp">--</span>
                                </div>
                                <div class="tyre" id="rigA-tyreRR">
                                    <span class="tyre-label">RR</span>
                                    <span class="tyre-temp">--</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Position & Lap -->
                    <div class="metric-card position-card">
                        <h3>Position</h3>
                        <div class="metric-value position" id="rigA-position">--</div>
                    </div>

                    <div class="metric-card laptime-card">
                        <h3>Current Lap</h3>
                        <div class="lap-info">
                            <div class="lap-number">Lap <span id="rigA-lapNum">--</span></div>
                            <div class="lap-time" id="rigA-currentLap">--:--.---</div>
                        </div>
                    </div>

                    <div class="metric-card lastlap-card">
                        <h3>Last Lap</h3>
                        <div class="metric-value lap-time" id="rigA-lastLap">--:--.---</div>
                    </div>

                    <!-- DRS Status -->
                    <div class="metric-card drs-card">
                        <h3>DRS</h3>
                        <div class="drs-status" id="rigA-drsStatus">
                            <div class="drs-indicator" id="rigA-drsIndicator">DISABLED</div>
                            <div class="drs-distance" id="rigA-drsDistance">--m</div>
                        </div>
                    </div>

                    <!-- Fuel -->
                    <div class="metric-card fuel-card">
                        <h3>Fuel</h3>
                        <div class="fuel-info">
                            <div class="fuel-amount" id="rigA-fuel">-- kg</div>
                            <div class="fuel-laps" id="rigA-fuelLaps">-- laps</div>
                        </div>
                    </div>

                    <!-- ERS Energy -->
                    <div class="metric-card ers-card">
                        <h3>ERS</h3>
                        <div class="ers-info">
                            <div class="ers-energy" id="rigA-ersEnergy">-- MJ</div>
                            <div class="ers-bar-container">
                                <div class="ers-bar" id="rigA-ersBar"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Tyre Wear -->
                    <div class="metric-card tyre-wear-card">
                        <h3>Tyre Wear (%)</h3>
                        <div class="tyres">
                            <div class="tyre-row">
                                <div class="tyre-wear" id="rigA-wearFL">
                                    <span class="tyre-label">FL</span>
                                    <span class="wear-value">--</span>
                                </div>
                                <div class="tyre-wear" id="rigA-wearFR">
                                    <span class="tyre-label">FR</span>
                                    <span class="wear-value">--</span>
                                </div>
                            </div>
                            <div class="tyre-row">
                                <div class="tyre-wear" id="rigA-wearRL">
                                    <span class="tyre-label">RL</span>
                                    <span class="wear-value">--</span>
                                </div>
                                <div class="tyre-wear" id="rigA-wearRR">
                                    <span class="tyre-label">RR</span>
                                    <span class="wear-value">--</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Session Info -->
                    <div class="metric-card session-card">
                        <h3>Session</h3>
                        <div class="session-info">
                            <div class="session-id">ID: <span id="rigA-sessionId">--</span></div>
                            <div class="frame-count">Frame: <span id="rigA-frame">0</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CENTER: Leaderboard Column -->
            <div class="leaderboard-column">
                <div class="leaderboard-column-header">
                    <h2>Leaderboard</h2>
                    <div class="leaderboard-column-controls">
                        <button class="btn-small btn-view-toggle" id="viewToggleBtn" title="Toggle view">Combined</button>
                    </div>
                </div>

                <!-- Combined View -->
                <div class="leaderboard-view combined-view" id="combinedLeaderboard">
                    <div class="session-best-overall">
                        <div class="session-best-label">Overall Session Best</div>
                        <div class="session-best-player" id="overallSessionBestPlayer">--</div>
                        <div class="session-best-info">
                            <div class="session-best-time-large" id="overallSessionBest">--:--.---</div>
                            <div class="session-best-details">
                                <span class="session-best-rig-badge" id="overallSessionBestRig"></span>
                                <span class="session-best-lap-info" id="overallSessionBestLap">Lap --</span>
                            </div>
                        </div>
                    </div>
                    <div class="leaderboard-controls-icons">
                        <button class="btn-icon btn-save-icon" id="saveSessionBtn" title="Save Session">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                                <polyline points="17 21 17 13 7 13 7 21"/>
                                <polyline points="7 3 7 8 15 8"/>
                            </svg>
                        </button>
                        <button class="btn-icon btn-reset-icon" id="resetCurrentBtn" title="Reset Current Session">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="1 4 1 10 7 10"/>
                                <polyline points="23 20 23 14 17 14"/>
                                <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
                            </svg>
                        </button>
                    </div>
                    <div class="leaderboard-entries" id="combinedLeaderboardEntries">
                        <div class="no-data">No saved laps</div>
                    </div>
                </div>

                <!-- Split View -->
                <div class="leaderboard-view split-view-container" id="splitLeaderboard" style="display: none;">
                    <div class="leaderboard-controls-icons">
                        <button class="btn-icon btn-save-icon" id="saveSessionBtnSplit" title="Save Session">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                                <polyline points="17 21 17 13 7 13 7 21"/>
                                <polyline points="7 3 7 8 15 8"/>
                            </svg>
                        </button>
                        <button class="btn-icon btn-reset-icon" id="resetCurrentBtnSplit" title="Reset Current Session">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="1 4 1 10 7 10"/>
                                <polyline points="23 20 23 14 17 14"/>
                                <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
                            </svg>
                        </button>
                    </div>
                    <div class="split-leaderboards">
                        <div class="leaderboard-rig">
                            <h3>ðŸ”´ Sim Rig 1</h3>
                            <div class="session-best-compact">
                                <div class="session-best-label">Session Best</div>
                                <div class="session-best-time-compact" id="rigA-sessionBestSplit">--:--.---</div>
                                <div class="session-best-lap-compact" id="rigA-sessionBestLapSplit">Lap --</div>
                            </div>
                            <div class="leaderboard-entries-compact" id="rigA-leaderboardEntries">
                                <div class="no-data-compact">No saved laps</div>
                            </div>
                        </div>
                        <div class="leaderboard-rig">
                            <h3>ðŸ”µ Sim Rig 2</h3>
                            <div class="session-best-compact">
                                <div class="session-best-label">Session Best</div>
                                <div class="session-best-time-compact" id="rigB-sessionBestSplit">--:--.---</div>
                                <div class="session-best-lap-compact" id="rigB-sessionBestLapSplit">Lap --</div>
                            </div>
                            <div class="leaderboard-entries-compact" id="rigB-leaderboardEntries">
                                <div class="no-data-compact">No saved laps</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RIGHT: Sim Rig 2 Panel -->
            <div class="rig-panel" id="rigBPanel">
                <div class="rig-header rig-b-header">
                    <h2>ðŸ”µ Sim Rig 2</h2>
                    <div class="rig-status" id="rigBStatus">Waiting for data...</div>
                    <div class="driver-name" id="rigBDriver">{{ rigs[1].driver_name }}</div>
                    <div class="session-details">
                        <span class="track-name" id="rigB-trackName">--</span> â€¢
                        <span class="session-type" id="rigB-sessionType">--</span>
                    </div>
                </div>

                <div class="telemetry-grid">
                    <!-- Speed & Gear Row -->
                    <div class="metric-card speed-card">
                        <h3>Speed</h3>
                        <div class="metric-value large" id="rigB-speed">0</div>
                        <div class="metric-unit">km/h</div>
                    </div>

                    <div class="metric-card gear-card">
                        <h3>Gear</h3>
                        <div class="metric-value gear" id="rigB-gear">N</div>
                    </div>

                    <!-- RPM -->
                    <div class="metric-card rpm-card">
                        <h3>RPM</h3>
                        <div class="metric-value large" id="rigB-rpm">0</div>
                        <div class="rpm-bar-container">
                            <div class="rpm-bar" id="rigB-rpmBar"></div>
                        </div>
                    </div>

                    <!-- Throttle/Brake/Steering -->
                    <div class="metric-card inputs-card">
                        <h3>Inputs</h3>
                        <div class="input-bars">
                            <div class="input-row">
                                <label>Throttle</label>
                                <div class="bar-container">
                                    <div class="bar throttle-bar" id="rigB-throttleBar"></div>
                                </div>
                                <span class="input-value" id="rigB-throttle">0%</span>
                            </div>
                            <div class="input-row">
                                <label>Brake</label>
                                <div class="bar-container">
                                    <div class="bar brake-bar" id="rigB-brakeBar"></div>
                                </div>
                                <span class="input-value" id="rigB-brake">0%</span>
                            </div>
                            <div class="input-row steering-row">
                                <label>Steering</label>
                                <div class="steering-wheel-container">
                                    <svg class="steering-wheel" viewBox="0 0 120 120" width="120" height="120">
                                        <defs>
                                            <!-- Gradient for wheel -->
                                            <radialGradient id="wheelGradientB">
                                                <stop offset="0%" style="stop-color:#4a5568;stop-opacity:1" />
                                                <stop offset="100%" style="stop-color:#2d3748;stop-opacity:1" />
                                            </radialGradient>
                                        </defs>

                                        <!-- Outer ring -->
                                        <circle cx="60" cy="60" r="45" fill="none" stroke="#2a2f3e" stroke-width="8"/>

                                        <!-- Steering wheel with rotation -->
                                        <g id="rigB-wheelRotate">
                                            <!-- Wheel rim -->
                                            <circle cx="60" cy="60" r="35" fill="url(#wheelGradientB)" stroke="#1a202c" stroke-width="3"/>

                                            <!-- Spokes -->
                                            <line x1="60" y1="30" x2="60" y2="90" stroke="#1a202c" stroke-width="4"/>
                                            <line x1="30" y1="60" x2="90" y2="60" stroke="#1a202c" stroke-width="4"/>

                                            <!-- Center hub -->
                                            <circle cx="60" cy="60" r="10" fill="#1a202c" stroke="#4a5568" stroke-width="2"/>

                                            <!-- Top marker (12 o'clock position) -->
                                            <circle cx="60" cy="30" r="4" fill="#FFB740"/>
                                        </g>
                                    </svg>

                                    <!-- Direction indicators -->
                                    <div class="steering-indicators">
                                        <div class="steer-indicator left" id="rigB-steerLeft">L</div>
                                        <div class="steer-indicator right" id="rigB-steerRight">R</div>
                                    </div>
                                </div>
                                <span class="input-value" id="rigB-steer">0Â°</span>
                            </div>
                        </div>
                    </div>

                    <!-- G-Forces -->
                    <div class="metric-card gforce-card">
                        <h3>G-Forces</h3>
                        <div class="gforce-display">
                            <div class="gforce-item">
                                <span class="gforce-label">LAT</span>
                                <span class="gforce-value" id="rigB-gLat">0.0</span>
                            </div>
                            <div class="gforce-item">
                                <span class="gforce-label">LONG</span>
                                <span class="gforce-value" id="rigB-gLong">0.0</span>
                            </div>
                            <div class="gforce-item">
                                <span class="gforce-label">VERT</span>
                                <span class="gforce-value" id="rigB-gVert">0.0</span>
                            </div>
                        </div>
                    </div>

                    <!-- Tyre Temps -->
                    <div class="metric-card tyre-card">
                        <h3>Tyre Temps (Â°C)</h3>
                        <div class="tyres">
                            <div class="tyre-row">
                                <div class="tyre" id="rigB-tyreFL">
                                    <span class="tyre-label">FL</span>
                                    <span class="tyre-temp">--</span>
                                </div>
                                <div class="tyre" id="rigB-tyreFR">
                                    <span class="tyre-label">FR</span>
                                    <span class="tyre-temp">--</span>
                                </div>
                            </div>
                            <div class="tyre-row">
                                <div class="tyre" id="rigB-tyreRL">
                                    <span class="tyre-label">RL</span>
                                    <span class="tyre-temp">--</span>
                                </div>
                                <div class="tyre" id="rigB-tyreRR">
                                    <span class="tyre-label">RR</span>
                                    <span class="tyre-temp">--</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Position & Lap -->
                    <div class="metric-card position-card">
                        <h3>Position</h3>
                        <div class="metric-value position" id="rigB-position">--</div>
                    </div>

                    <div class="metric-card laptime-card">
                        <h3>Current Lap</h3>
                        <div class="lap-info">
                            <div class="lap-number">Lap <span id="rigB-lapNum">--</span></div>
                            <div class="lap-time" id="rigB-currentLap">--:--.---</div>
                        </div>
                    </div>

                    <div class="metric-card lastlap-card">
                        <h3>Last Lap</h3>
                        <div class="metric-value lap-time" id="rigB-lastLap">--:--.---</div>
                    </div>

                    <!-- DRS Status -->
                    <div class="metric-card drs-card">
                        <h3>DRS</h3>
                        <div class="drs-status" id="rigB-drsStatus">
                            <div class="drs-indicator" id="rigB-drsIndicator">DISABLED</div>
                            <div class="drs-distance" id="rigB-drsDistance">--m</div>
                        </div>
                    </div>

                    <!-- Fuel -->
                    <div class="metric-card fuel-card">
                        <h3>Fuel</h3>
                        <div class="fuel-info">
                            <div class="fuel-amount" id="rigB-fuel">-- kg</div>
                            <div class="fuel-laps" id="rigB-fuelLaps">-- laps</div>
                        </div>
                    </div>

                    <!-- ERS Energy -->
                    <div class="metric-card ers-card">
                        <h3>ERS</h3>
                        <div class="ers-info">
                            <div class="ers-energy" id="rigB-ersEnergy">-- MJ</div>
                            <div class="ers-bar-container">
                                <div class="ers-bar" id="rigB-ersBar"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Tyre Wear -->
                    <div class="metric-card tyre-wear-card">
                        <h3>Tyre Wear (%)</h3>
                        <div class="tyres">
                            <div class="tyre-row">
                                <div class="tyre-wear" id="rigB-wearFL">
                                    <span class="tyre-label">FL</span>
                                    <span class="wear-value">--</span>
                                </div>
                                <div class="tyre-wear" id="rigB-wearFR">
                                    <span class="tyre-label">FR</span>
                                    <span class="wear-value">--</span>
                                </div>
                            </div>
                            <div class="tyre-row">
                                <div class="tyre-wear" id="rigB-wearRL">
                                    <span class="tyre-label">RL</span>
                                    <span class="wear-value">--</span>
                                </div>
                                <div class="tyre-wear" id="rigB-wearRR">
                                    <span class="tyre-label">RR</span>
                                    <span class="wear-value">--</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Session Info -->
                    <div class="metric-card session-card">
                        <h3>Session</h3>
                        <div class="session-info">
                            <div class="session-id">ID: <span id="rigB-sessionId">--</span></div>
                            <div class="frame-count">Frame: <span id="rigB-frame">0</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/dual-rig-dashboard.js') }}"></script>
</body>
</html>
